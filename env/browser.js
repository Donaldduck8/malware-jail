_browser_documents = [];

location = {
    _name : "location",
    _href: "http://example.com/",
    replace: function(n) {
        util_log(this._name + ".replace("+n+")");
        _href = n;
    }
}
Object.defineProperty(location, "href", {
    get: function() {
        util_log(this._name+".href.get()");
        return this._href;
    },
    set: function(n) {
        util_log(this._name+".href.set("+n+")");
        this._href = n;
    }
})

window = new function() {
    this.id = id++;
    this._name = "window[" + this.id + "]";
    util_log("Created: " + this._name);
    //TODO: move different browser properties to a separate files
    //this.userAgent = "Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; .NET CLR 2.7.58687; SLCC2; Media Center PC 5.0; Zune 3.4; Tablet PC 3.6; InfoPath.3)";
    //this._userAgent = "Mozilla/5.0 (iPhone; CPU iPhone OS 8_1_1 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) CriOS/47.0.2526.70 Mobile/12B436 Safari/600.1.4 (000410)";
    this._userAgent = "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko";
    //this._chrome = true;
    this._chrome = false;
    //this._vendor = "Google Inc.";
    this._vendor = "Microsoft";
    this.eval = eval;
    this.setInterval = function() {
        util_log(this._name + ".setInterval(" + Array.prototype.slice.call(arguments, 0).join(",") + ")");
        util_log(typeof arguments[0]);
        arguments[0].apply(this, Array.prototype.slice.call(arguments, 1));
    }

    this.clearInterval = function() {
        util_log(this._name + ".clearInterval(" + Array.prototype.slice.call(arguments, 0).join(",") + ")");
    }
    this.navigator = this;
    this._location = location,
    Object.defineProperty(this, "location", {
        get: function() {
            util_log("document.location.get()");
            return this._location;
        },
        set: function(n) {
            util_log("document.location.set("+n+")");
            this._location.href = n;
        }
    })

    // TODO: generate property interceptors with template/eval rather then hardcoding.
    Object.defineProperty(this, "userAgent", {
        get: function() {
            util_log("document.userAgent.get()");
            return this._userAgent;
        },
        set: function(n) {
            util_log("document.userAgent.set("+n+")");
            this._userAgent = n;
        }
    })
    Object.defineProperty(this, "chrome", {
        get: function() {
            util_log("document.chrome.get()");
            return this._chrome;
        },
        set: function(n) {
            util_log("document.chrome.set("+n+")");
            this._chrome = n;
        }
    })
    Object.defineProperty(this, "vendor", {
        get: function() {
            util_log("document.vendor.get()");
            return this._vendor;
        },
        set: function(n) {
            util_log("document.vendor.set("+n+")");
            this._vendor = n;
        }
    })

}();

setInterval = window.setInterval.bind(window);
clearInterval = window.clearInterval.bind(window);

navigator = window;


document = {
    _name : "document",
    _content : "",
    _elements : {},
    getElementsByTagName: function(n) {
        util_log(this._name + ".getElementsByTagName("+n+")");
        return new Element(n);
    },
    getElementById: function(n) {
        util_log(this._name + ".getElementById("+n+")");
        if (n in this._elements)
            return this._elements[n];
        else
            return new Element(n);
    },
    createElement: function(n) {
        util_log(this._name + ".createElement("+n+")");
        return new Element(n);
    },
    createTextNode: function(n) {
        util_log(this._name + ".createTextNode("+n+")");
        return new Element(n);
    },
    write: function(c) {
        util_log(this._name + ".write(content) " + c.length + " bytes");
        _content = c;
        _browser_documents[_browser_documents.length] = c;
    },
    _addElementById: function(id, content) {
        this._elements[id] = new Element(id);
        this._elements[id].innerHTML = content;
    },
    _location : location,
    _cookie: ""
}
document._body = document.createElement("body");

Object.defineProperty(document, "location", {
    get: function() {
        util_log("document.location.get()");
        return this._location;
    },
    set: function(n) {
        util_log("document.location.set("+n+")");
        this._location.href = n;
    }
})
Object.defineProperty(document, "body", {
    get: function() {
        util_log("document.body.get()");
        return this._body;
    },
    set: function(n) {
        util_log("document.body.set("+n+")");
        this._body = n;
    }
})
Object.defineProperty(document, "cookie", {
    get: function() {
        util_log("document.cookie.get()");
        return this._cookie;
    },
    set: function(n) {
        util_log("document.cookie.set("+n+")");
        this._cookie = n;
    }
})
